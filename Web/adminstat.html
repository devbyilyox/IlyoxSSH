<!doctype html>
<html lang="fr">
<head>
<meta charset="utf-8"/><meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Ilyox'SSH — Admin</title>
<style>
  :root{--bg:#0f0f12;--card:#111113;--muted:#99a3b0;--accent:#7d2ae8;--ok:#2ec27e;--minor:#f6c84c;--major:#ff6b6b;--maint:#7d7dfa}
  body{margin:0;font-family:Inter,system-ui,Arial;background:linear-gradient(180deg,#07070a,#0f0f12);color:#eef2f7}
  .wrap{max-width:1000px;margin:28px auto;padding:20px}
  header{display:flex;align-items:center;gap:12px}
  .logo{font-weight:800;font-size:20px;padding:10px 14px;border-radius:8px;background:linear-gradient(90deg,var(--accent),#4c0ca0)}
  .card{background:var(--card);padding:18px;border-radius:12px;box-shadow:0 6px 20px rgba(0,0,0,0.5)}
  form{display:grid;gap:10px}
  label{font-size:13px;color:var(--muted)}
  input[type=text], textarea, select{background:#0b0b0d;border:1px solid rgba(255,255,255,0.03);color:#fff;padding:10px;border-radius:8px}
  .row{display:flex;gap:10px}
  .btn{padding:10px 14px;border-radius:8px;background:var(--accent);color:#fff;border:none;cursor:pointer}
  .btn.danger{background:#ff5a5a}
  .help{color:var(--muted);font-size:13px}
  .small{font-size:13px;color:var(--muted)}
</style>
</head>
<body>
  <div class="wrap">
    <header>
      <div class="logo">Ilyox'SSH — Admin</div>
      <div>
        <h2 style="margin:0">Panneau d'administration</h2>
        <div class="small">Protégé par mot de passe</div>
      </div>
    </header>

    <div style="height:16px"></div>

    <div id="loginCard" class="card">
      <h3>Connexion administrateur</h3>
      <div class="help">Entrez le mot de passe admin pour accéder au panneau.</div>
      <div style="height:10px"></div>
      <input id="pwd" type="password" placeholder="Mot de passe admin"/>
      <div style="height:8px"></div>
      <button id="loginBtn" class="btn">Se connecter</button>
      <div id="loginMsg" class="small" style="margin-top:8px"></div>
    </div>

    <div id="adminPanel" style="display:none;margin-top:18px">
      <div class="card">
        <h3>État global</h3>
        <div class="row">
          <select id="globalState">
            <option value="ok">OPERATIONNEL</option>
            <option value="minor">DEGRADÉ</option>
            <option value="major">MAJOR OUTAGE</option>
            <option value="maint">MAINTENANCE</option>
          </select>
          <input id="globalMsg" type="text" placeholder="Message (ex: Problème sur l'API X)"/>
          <button id="saveGlobal" class="btn">Enregistrer</button>
        </div>
        <div style="height:12px"></div>

        <h3>Créer un incident</h3>
        <div class="help">Ajoute un incident visible sur la page de statut.</div>
        <form id="incidentForm" onsubmit="return false;">
          <label>Titre</label>
          <input id="incTitle" type="text" required />
          <label>Détails</label>
          <textarea id="incDetails" rows="4"></textarea>
          <label>Gravité</label>
          <select id="incSeverity">
            <option value="minor">DEGRADÉ</option>
            <option value="major">MAJOR</option>
            <option value="maint">MAINTENANCE</option>
            <option value="ok">INFO</option>
          </select>
          <div style="height:8px"></div>
          <div style="display:flex;gap:8px">
            <button id="addInc" class="btn">Ajouter l'incident</button>
            <button id="clearAll" class="btn danger">Supprimer tout (local)</button>
          </div>
        </form>
        <div style="height:12px"></div>
        <div class="small">Toutes les modifications sont stockées localement dans le navigateur (localStorage).</div>
      </div>

      <div style="height:12px"></div>

      <div class="card">
        <h3>Actions</h3>
        <div style="display:flex;gap:8px">
          <button id="exportBtn" class="btn">Exporter JSON</button>
          <button id="importBtn" class="btn">Importer JSON</button>
          <input id="importFile" type="file" accept="application/json" style="display:none"/>
        </div>
        <div style="height:8px"></div>
        <div class="small">Pour que les modifications soient visibles partout, uploadez le JSON exporté sur votre serveur et adaptez la page publique pour le récupérer (ou configurez un endpoint simple).</div>
      </div>
    </div>

  </div>

<script>
// ADMIN: change this hash to the SHA-256 of your admin password BEFORE deploy.
// current default is SHA256("admin123") => 240be518fabd2724ddb6f04eeb1da5967448d7e831c08c8fa822809f74c720a9
const ADMIN_HASH = "240be518fabd2724ddb6f04eeb1da5967448d7e831c08c8fa822809f74c720a9";
const STORAGE_KEY = 'ilyox_status_data';

async function sha256Hex(msg){
  const enc = new TextEncoder();
  const data = enc.encode(msg);
  const hash = await crypto.subtle.digest('SHA-256', data);
  return Array.from(new Uint8Array(hash)).map(b=>b.toString(16).padStart(2,'0')).join('');
}

document.getElementById('loginBtn').addEventListener('click', async ()=>{
  const pwd = document.getElementById('pwd').value||'';
  document.getElementById('loginMsg').textContent = 'Vérification...';
  const h = await sha256Hex(pwd);
  if(h === ADMIN_HASH){
    document.getElementById('loginCard').style.display='none';
    document.getElementById('adminPanel').style.display='';
    loadToForm();
  } else {
    document.getElementById('loginMsg').textContent = 'Mot de passe invalide';
  }
});

// utilities
function loadData(){
  try{
    const raw = localStorage.getItem(STORAGE_KEY);
    return raw? JSON.parse(raw): { global:{state:'ok',message:'Tout est opérationnel',updated:Date.now()}, incidents:[], history:[] };
  }catch(e){ return { global:{state:'ok',message:'Tout est opérationnel',updated:Date.now()}, incidents:[], history:[] }; }
}
function saveData(d){
  localStorage.setItem(STORAGE_KEY, JSON.stringify(d));
}

function loadToForm(){
  const d = loadData();
  document.getElementById('globalState').value = d.global?.state||'ok';
  document.getElementById('globalMsg').value = d.global?.message||'';
}

document.getElementById('saveGlobal').addEventListener('click', ()=>{
  const state = document.getElementById('globalState').value;
  const msg = document.getElementById('globalMsg').value;
  const d = loadData();
  d.global = { state, message: msg|| (state==='ok'?'Tout fonctionne normalement':'Problème en cours'), updated: Date.now() };
  d.history = d.history || [];
  d.history.push({ t: Date.now(), msg: `Global: ${state} - ${msg||''}` });
  saveData(d);
  alert('Statut global mis à jour (localStorage).');
});

document.getElementById('addInc').addEventListener('click', ()=>{
  const t = document.getElementById('incTitle').value.trim();
  const details = document.getElementById('incDetails').value.trim();
  const sev = document.getElementById('incSeverity').value;
  if(!t){ alert('Donne un titre à l\'incident'); return; }
  const d = loadData();
  d.incidents = d.incidents || [];
  d.incidents.push({ id: 'inc_' + Date.now(), title: t, details: details, severity: sev, created: Date.now() });
  d.history = d.history || [];
  d.history.push({ t: Date.now(), msg: `Incident créé: ${t}` });
  saveData(d);
  document.getElementById('incTitle').value=''; document.getElementById('incDetails').value='';
  alert('Incident ajouté (localStorage).');
});

document.getElementById('clearAll').addEventListener('click', ()=>{
  if(!confirm('Supprimer toutes les données locales (incidents + history + global) ?')) return;
  localStorage.removeItem(STORAGE_KEY);
  alert('Données locales supprimées.');
});

// Export / Import
document.getElementById('exportBtn').addEventListener('click', ()=>{
  const d = loadData();
  const blob = new Blob([JSON.stringify(d, null, 2)], {type:'application/json'});
  const url = URL.createObjectURL(blob);
  const a = document.createElement('a');
  a.href = url; a.download = 'ilyox_status_export.json'; document.body.appendChild(a); a.click();
  URL.revokeObjectURL(url); a.remove();
});

document.getElementById('importBtn').addEventListener('click', ()=> document.getElementById('importFile').click());
document.getElementById('importFile').addEventListener('change', (ev)=>{
  const f = ev.target.files[0];
  if(!f) return;
  const r = new FileReader();
  r.onload = ()=> {
    try{
      const j = JSON.parse(r.result);
      if(confirm('Ecraser les données locales par ce fichier importé ?')){
        saveData(j);
        alert('Import OK');
      }
    }catch(e){ alert('Fichier invalide'); }
  };
  r.readAsText(f);
});
</script>
</body>
</html>
